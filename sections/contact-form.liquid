{{ 'section-contact-form.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* --- Added image layout --- */
  .contact-form__outer {
    display: flex;
    flex-direction: row;
    align-items: center;
    border-radius: 30px;
    border: 1px solid #27315447;
    gap: 25px;
  }

  @media (min-width: 750px) {
    .contact-form__outer {
      flex-direction: row;
      height: 600px;
    }

    .contact-form__outer.image-left {
      flex-direction: row-reverse;
    }
  }
  
  .contact-form__outer.image-left .contact-form__image img{
    border-radius: 0px 28px 28px 0px;
  }

  @media screen and (max-width: 749px) {
    .contact-form__image img {
      border-radius: 28px 28px 0px 0px !important;
    }

    .contact-form__outer {
      flex-direction: column;
    }
  }

  @media screen and (min-width: 750px) {
    .contact-form__image {
      text-align: center;
      width: 50%;
      height: 100%;
    }
  }

  .contact-form__image img {
    width: 100%;
    height: 100%;
    max-height: 600px;
    object-fit: cover;
    border-radius: 28px 0px 0px 28px;
    display: block;
  }

  .contact-form__main {
    width: 100%;
    padding: 20px 0px;
    height: 100%;
    display: flex;
    align-items: center;
  }

  @media screen and (min-width: 750px) {
    .contact-form__main {
      width: 50%;
    }
  }
 
  @media screen and (max-width: 750px) {
    .contact-form__main {
      padding: 0px;
    }

    .contact-form__image img {
      height: 400px;
    }
  }

  @media screen and (max-width: 500px) {
    .contact-form__image img {
      height: 300px;
    }
  }
{%- endstyle -%}

<div
  class="contact-form color-{{ section.settings.color_scheme }} section-{{ section.id }}-padding{% if section.settings.enable_grid_effect %} contact-form--grid-effect{% endif %}{% if section.settings.enable_animation %} contact-form--animated{% endif %}"
>
  <div class="page-width" style="padding: 20px;">
    <div class="contact-form__outer {% if section.settings.image_position == 'left' %}image-left{% endif %}">
      {% if section.settings.side_image != blank %}
        <div class="contact-form__image">
          <img src="{{ section.settings.side_image | img_url: 'master' }}" alt="Newsletter image">
        </div>
      {% endif %}

      <div class="contact-form__main">
        <div class="contact-form__container">
          <div class="contact-form__info">
            <div class="contact-form__title">{{ section.settings.title }}</div>
            <div class="contact-form__content">{{ section.settings.content }}</div>
          </div>

          <div class="contact-form__form-panel">
            <div class="contact-form__form-content">
              {%- form 'customer', id: 'NewsletterForm', class: 'contact-form__form' -%}
                {%- if form.posted_successfully? -%}
                  <div class="contact-form__message contact-form__message--success">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                      <polyline points="22,4 12,14.01 9,11.01"></polyline>
                    </svg>
                    {{ section.settings.success_message }}
                  </div>
                {%- elsif form.errors -%}
                  <div class="contact-form__message contact-form__message--error">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="15" y1="9" x2="9" y2="15"></line>
                      <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                    {{ form.errors.messages.email }}
                  </div>
                {%- endif -%}

                <div class="contact-form__field contact-form__field--inline">
                  <input
                    type="email"
                    id="NewsletterForm-email"
                    name="contact[email]"
                    class="contact-form__input"
                    placeholder="Email"
                    value="{{ form.email | escape }}"
                    required
                    aria-required="true"
                  >
                  <a href="" type="submit" class="contact-form__submit-btn">
                    {{ section.settings.button_label }}
                  </a>
                </div>
              {%- endform -%}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const contactForm = document.querySelector('.contact-form');
  
  if (contactForm && contactForm.classList.contains('contact-form--animated')) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          contactForm.classList.add('contact-form--animate-in');
          const animationType = '{{ section.settings.animation_type | default: "slide-up" }}';
          contactForm.classList.add(`contact-form--animate-${animationType}`);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
    observer.observe(contactForm);
  }

  if (contactForm && contactForm.classList.contains('contact-form--grid-effect')) {
    const gridStyle = '{{ section.settings.grid_style | default: "dots" }}';
    const gridSize = '{{ section.settings.grid_size | default: 20 }}';
    contactForm.classList.add(`contact-form--grid-${gridStyle}`);
    contactForm.style.setProperty('--grid-size', `${gridSize}px`);
  }
});
</script>

{% schema %}
{
  "name": "Newsletter Signup",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "side_image",
      "label": "Side Image"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Image Position",
      "options": [
        { "value": "right", "label": "Right" },
        { "value": "left", "label": "Left" }
      ],
      "default": "right"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Receber novidades & promoções"
    },
    {
      "type": "richtext",
      "id": "content",
      "label": "Content"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "Subscrever"
    },
    {
      "type": "checkbox",
      "id": "enable_grid_effect",
      "default": false,
      "label": "Enable Grid Effect"
    },
    {
      "type": "checkbox",
      "id": "enable_animation",
      "default": true,
      "label": "Enable Animation Effects"
    },
    {
      "type": "select",
      "id": "animation_type",
      "options": [
        { "value": "fade-in", "label": "Fade In" },
        { "value": "slide-up", "label": "Slide Up" },
        { "value": "slide-left", "label": "Slide Left" },
        { "value": "slide-right", "label": "Slide Right" },
        { "value": "zoom-in", "label": "Zoom In" }
      ],
      "default": "slide-up",
      "label": "Animation Type"
    },
    {
      "type": "range",
      "id": "animation_duration",
      "min": 0.3,
      "max": 2.0,
      "step": 0.1,
      "unit": "s",
      "label": "Animation Duration",
      "default": 0.6
    },
    {
      "type": "range",
      "id": "animation_delay",
      "min": 0,
      "max": 1.0,
      "step": 0.1,
      "unit": "s",
      "label": "Animation Delay",
      "default": 0.2
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    }
  ],
  "presets": [
    { "name": "Newsletter Signup" }
  ]
}
{% endschema %}
